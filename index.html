<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NYC Apartment Finder</title>
  <style>
    /* Basic Reset and Styles */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f9f9f9;
    }
    header {
      background: #4CAF50;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .container {
      margin: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      text-align: left;
      padding: 12px;
      border: 1px solid #ddd;
      vertical-align: middle;
    }
    th {
      background: #f2f2f2;
    }
    input[type="text"],
    input[type="number"],
    input[type="url"] {
      width: 100%;
      padding: 6px;
      box-sizing: border-box;
    }
    button {
      padding: 6px 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 2px;
    }
    /* Style checkboxes inline inside the cell */
    .amenity-option {
      margin-right: 8px;
    }
    .footer {
      text-align: center;
      padding: 10px;
      margin-top: 40px;
      font-size: 0.9em;
      color: #666;
    }
  </style>
</head>
<body>
  <header>
    <h1>NYC Apartment Finder</h1>
    <p>Helping you decide where to live in New York City.</p>
  </header>
  <div class="container">
    <table id="listingsTable">
      <thead>
        <tr>
          <th>Price</th>
          <th>Location</th>
          <th>Neighborhood</th>
          <th>Bathrooms</th>
          <th>Bedrooms</th>
          <th>Distance to Work X</th>
          <th>Distance to Work Y</th>
          <th>Amenities</th>
          <th>Original URL</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- New Listing Input Row -->
        <tr id="newListingRow">
          <td><input type="text" id="newPrice" placeholder="Price"></td>
          <td><input type="text" id="newLocation" placeholder="Location"></td>
          <td><input type="text" id="newNeighborhood" placeholder="Neighborhood"></td>
          <td><input type="number" id="newBathrooms" placeholder="Bathrooms"></td>
          <td><input type="number" id="newBedrooms" placeholder="Bedrooms"></td>
          <td><input type="text" id="newDistanceX" placeholder="Distance to Work X"></td>
          <td><input type="text" id="newDistanceY" placeholder="Distance to Work Y"></td>
          <!-- Amenities: Pre-defined checkboxes -->
          <td id="newAmenitiesCell">
            <label class="amenity-option">
              <input type="checkbox" value="Laundry Room">Laundry Room
            </label>
            <label class="amenity-option">
              <input type="checkbox" value="AC">AC
            </label>
            <label class="amenity-option">
              <input type="checkbox" value="Gym">Gym
            </label>
            <label class="amenity-option">
              <input type="checkbox" value="Game room">Game room
            </label>
            <label class="amenity-option">
              <input type="checkbox" value="Pool">Pool
            </label>
          </td>
          <td><input type="url" id="newOriginalUrl" placeholder="Original URL"></td>
          <td><input type="text" id="newNotes" placeholder="Notes"></td>
          <td><button id="addListingBtn">Add</button></td>
        </tr>
        <!-- Existing listings will be inserted here -->
      </tbody>
    </table>
  </div>
  <footer class="footer">
    <p>&copy; 2025 NYC Apartment Finder</p>
  </footer>
  <script>
    // Pre-defined list of amenity options
    const amenityOptions = ["Laundry Room", "AC", "Gym", "Game room", "Pool"];
    
    // Global array to hold listing objects
    let listings = [];

    // Load listings from localStorage if available
    function loadListings() {
      let saved = localStorage.getItem('apartmentListings');
      if (saved) {
        try {
          listings = JSON.parse(saved);
        } catch(e) {
          listings = [];
        }
      }
    }

    // Save listings to localStorage
    function saveListings() {
      localStorage.setItem('apartmentListings', JSON.stringify(listings));
    }

    // Create a table row to display a listing (non-editable mode)
    function createRow(listing, index) {
      let tr = document.createElement('tr');
      tr.setAttribute('data-index', index);

      function createCell(content) {
        let td = document.createElement('td');
        td.innerHTML = content;
        return td;
      }

      tr.appendChild(createCell(listing.price));
      tr.appendChild(createCell(listing.location));
      tr.appendChild(createCell(listing.neighborhood));
      tr.appendChild(createCell(listing.bathrooms));
      tr.appendChild(createCell(listing.bedrooms));
      tr.appendChild(createCell(listing.distanceToWorkX));
      tr.appendChild(createCell(listing.distanceToWorkY));
      // Amenities: display pre-defined amenity selections (comma-separated)
      tr.appendChild(createCell(listing.amenities));
      // Original URL as clickable link
      let urlCell = document.createElement('td');
      let link = document.createElement('a');
      link.href = listing.originalUrl;
      link.textContent = listing.originalUrl;
      link.target = '_blank';
      urlCell.appendChild(link);
      tr.appendChild(urlCell);
      // Notes
      tr.appendChild(createCell(listing.notes));
      
      // Actions cell: Edit button
      let actionCell = document.createElement('td');
      let editBtn = document.createElement('button');
      editBtn.textContent = 'Edit';
      editBtn.addEventListener('click', function() {
        enableEditing(tr, index);
      });
      actionCell.appendChild(editBtn);
      tr.appendChild(actionCell);

      return tr;
    }

    // Refresh table display by removing old rows and re-displaying from the listings array.
    function refreshTable() {
      const tbody = document.querySelector('#listingsTable tbody');
      // Remove all rows except the new listing row (identified by id)
      Array.from(tbody.querySelectorAll('tr')).forEach(tr => {
        if (tr.id !== 'newListingRow') {
          tr.remove();
        }
      });
      // Add rows for each listing in the array
      listings.forEach((listing, index) => {
        let row = createRow(listing, index);
        tbody.appendChild(row);
      });
    }

    // Helper: Get selected amenities from a container element (returns a comma-separated string)
    function getSelectedAmenities(container) {
      let checkboxes = container.querySelectorAll('input[type="checkbox"]');
      let selected = [];
      checkboxes.forEach(cb => {
        if (cb.checked) {
          selected.push(cb.value);
        }
      });
      return selected.join(', ');
    }

    // Add new listing using the values from the input row.
    function addNewListing() {
      let price = document.getElementById('newPrice').value.trim();
      let location = document.getElementById('newLocation').value.trim();
      let neighborhood = document.getElementById('newNeighborhood').value.trim();
      let bathrooms = document.getElementById('newBathrooms').value.trim();
      let bedrooms = document.getElementById('newBedrooms').value.trim();
      let distanceX = document.getElementById('newDistanceX').value.trim();
      let distanceY = document.getElementById('newDistanceY').value.trim();
      let originalUrl = document.getElementById('newOriginalUrl').value.trim();
      let notes = document.getElementById('newNotes').value.trim();
      
      // Get selected amenities from the amenities cell
      let newAmenitiesCell = document.getElementById("newAmenitiesCell");
      let amenities = getSelectedAmenities(newAmenitiesCell) || 'N/A';
      
      if (!price && !location && !neighborhood) {
        alert("Please fill in at least one of Price, Location, or Neighborhood.");
        return;
      }
      
      let newListing = {
        price: price || 'N/A',
        location: location || 'N/A',
        neighborhood: neighborhood || 'N/A',
        bathrooms: bathrooms || 0,
        bedrooms: bedrooms || 0,
        distanceToWorkX: distanceX || 'N/A',
        distanceToWorkY: distanceY || 'N/A',
        amenities: amenities,
        originalUrl: originalUrl || 'N/A',
        notes: notes || ''
      };
      listings.push(newListing);
      saveListings();
      refreshTable();
      // Clear input fields for the new row.
      document.getElementById('newPrice').value = '';
      document.getElementById('newLocation').value = '';
      document.getElementById('newNeighborhood').value = '';
      document.getElementById('newBathrooms').value = '';
      document.getElementById('newBedrooms').value = '';
      document.getElementById('newDistanceX').value = '';
      document.getElementById('newDistanceY').value = '';
      // Clear amenities checkboxes
      newAmenitiesCell.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
      document.getElementById('newOriginalUrl').value = '';
      document.getElementById('newNotes').value = '';
    }

    // Enable editing on an existing row.
    function enableEditing(row, index) {
      let listing = listings[index];
      row.innerHTML = '';
      
      // Helper to create a cell with an input field.
      function createInputCell(value, type = 'text') {
        let td = document.createElement('td');
        let input = document.createElement('input');
        input.type = type;
        input.value = value;
        td.appendChild(input);
        return td;
      }
      
      // Price, Location, Neighborhood, Bathrooms, Bedrooms,
      row.appendChild(createInputCell(listing.price));
      row.appendChild(createInputCell(listing.location));
      row.appendChild(createInputCell(listing.neighborhood));
      row.appendChild(createInputCell(listing.bathrooms, 'number'));
      row.appendChild(createInputCell(listing.bedrooms, 'number'));
      row.appendChild(createInputCell(listing.distanceToWorkX));
      row.appendChild(createInputCell(listing.distanceToWorkY));
      
      // Amenities: create a cell with checkboxes
      let amenitiesTd = document.createElement('td');
      amenityOptions.forEach(option => {
        let label = document.createElement('label');
        label.className = 'amenity-option';
        let checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = option;
        // Mark as checked if the listing's amenities (assumed comma-separated) include this option.
        let selectedAmenities = listing.amenities.split(',').map(a => a.trim());
        if (selectedAmenities.indexOf(option) > -1) {
          checkbox.checked = true;
        }
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(option));
        amenitiesTd.appendChild(label);
      });
      row.appendChild(amenitiesTd);
      
      // Original URL input
      row.appendChild(createInputCell(listing.originalUrl, 'url'));
      // Notes input
      row.appendChild(createInputCell(listing.notes));
      
      // Actions cell with Save and Cancel buttons.
      let actionCell = document.createElement('td');
      let saveBtn = document.createElement('button');
      saveBtn.textContent = 'Save';
      saveBtn.addEventListener('click', function() {
        let inputs = row.querySelectorAll('input');
        // The inputs order corresponds to:
        // [Price, Location, Neighborhood, Bathrooms, Bedrooms, DistanceX, DistanceY,
        // for Amenities we handle separately, then Original URL, then Notes].
        // So, get inputs for non-amenities fields:
        let updatedListing = {
          price: inputs[0].value.trim() || 'N/A',
          location: inputs[1].value.trim() || 'N/A',
          neighborhood: inputs[2].value.trim() || 'N/A',
          bathrooms: inputs[3].value.trim() || 0,
          bedrooms: inputs[4].value.trim() || 0,
          distanceToWorkX: inputs[5].value.trim() || 'N/A',
          distanceToWorkY: inputs[6].value.trim() || 'N/A',
          // Amenities will be gathered from the checkboxes in the amenities cell
          amenities: '',
          originalUrl: inputs[inputs.length - 2].value.trim() || 'N/A',
          notes: inputs[inputs.length - 1].value.trim() || ''
        };
        // The amenities cell is the 8th cell (index 7) in the row.
        let amenityCheckboxes = row.children[7].querySelectorAll('input[type="checkbox"]');
        let selected = [];
        amenityCheckboxes.forEach(cb => { if (cb.checked) selected.push(cb.value); });
        updatedListing.amenities = selected.join(', ') || 'N/A';
        
        listings[index] = updatedListing;
        saveListings();
        refreshTable();
      });
      
      let cancelBtn = document.createElement('button');
      cancelBtn.textContent = 'Cancel';
      cancelBtn.addEventListener('click', refreshTable);
      
      actionCell.appendChild(saveBtn);
      actionCell.appendChild(cancelBtn);
      row.appendChild(actionCell);
    }

    // Set event listener for the Add button.
    document.getElementById('addListingBtn').addEventListener('click', addNewListing);

    // On page load, load any saved listings and refresh the table.
    window.addEventListener('load', function() {
      loadListings();
      refreshTable();
    });
  </script>
</body>
</html>
